{% extends 'base.html.twig' %}

{% block title %}Item{% endblock %}

{% block body %}
    <div class="p-6 flex flex-col gap-6">
        <div
            class="card w-full bg-base-100 border border-base-300 overflow-hidden"
        >
            <div class="card-body flex flex-col sm:flex-row gap-4">
                {% if item.imageUrl %}
                    <figure class="max-h-80 overflow-hidden">
                        <img src="{{ item.imageUrl ?? '/images/default-item.png' }}" alt="{{ item.name }}" class="object-fill rounded-box">
                    </figure>
                {% endif %}
                <div class="flex-1 flex flex-col gap-4">
                    <div class="flex items-center justify-between">
                        <h1 class="text-3xl  font-bold text-primary">{{ item.name }}</h1>
                        {% if item.createdBy %}
                            <a href="{{ path('app_item_show', { 'id': item.createdBy.id }) }}" class="avatar tooltip tooltip-bottom" data-tip="{{ item.createdBy.displayName }}">
                                <div class="w-12 rounded-full border border-base-300">
                                    {% if item.createdBy.avatar %}
                                        <img src="{{ item.createdBy.avatar }}" alt="{{ item.createdBy.username }}">
                                    {% else %}
                                        {{ ux_icon('lucide:user-round') }}
                                    {% endif %}
                                </div>
                            </a>
                        {% endif %}
                    </div>
                    <p class="text-neutral text-lg hidden sm:block">{{ item.description }}</p>

                    <div class="flex flex-wrap gap-3 mt-4">
                        <span class="badge badge-secondary gap-1">
                            <i class="iconify" data-icon="{{ item.category.icon ?? 'mdi:package-variant' }}"></i>
                            {{ item.category.name }}
                        </span>
                        <span class="badge {{ item.status.value == 'validated' ? 'badge-success' : item.status.value == 'pending' ? 'badge-info' : 'badge-error'}}">{{ item.status.label }}</span>
            {#  TODO AJOUTER COMME KIT UN CHAMP STATS POUR RECUPERER LES DATAS VARIANTS (RANGE POIDS, PRIX) ??? Variants dispo ... #}
            {#                    <span class="badge badge-outline">Poids: {{ item.weight }} g</span>#}
            {#                    <span class="badge badge-outline">Prix: {{ item.price|number_format(2, '.', ' ') }} €</span>#}
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2 justify-between items-center">
                        <p class="text-base-content/70 text-sm">Updated {{ item.updatedAt|date }}</p>
                        {% if app.user and app.user.admin or item.createdBy == app.user and item.status.value == 'pending' %}
                            <div class="flex items-end gap-2">
                                <a href="{{ path('app_item_edit', {'id': item.id}) }}"
                                   class="btn btn-primary">Edit</a>
                                {{ include('item/_delete_form.html.twig') }}
                            </div>
                        {% endif %}
                        {% if app.user and app.user.admin %}
                            <div class="flex items-end gap-2">
                                <a href="{{ path('app_item_validate', {'id': item.id}) }}" class="btn btn-success">Validate</a>
                                <a href="{{ path('app_item_reject', {'id': item.id}) }}" class="btn btn-error">Reject</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="card w-full bg-base-100 border border-base-300 p-6">
            <h2 class="text-xl font-bold text-primary mb-4">Specifications</h2>
            {% if item.specifications is not empty %}
                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full border-y border-base-300">
                        <tbody>
                        {% for key, value in item.specifications %}
                            <tr>
                                <td class="font-medium capitalize">{{ key|replace({'_':' '})|capitalize }}</td>
                                {% if value is iterable %}
                                    <td>{{ value|map(v => "#{v}")|join(', ') }}</td>
                                {% elseif value is same as(true) or value is same as(false) %}
                                    <td>{{ value ? 'Yes' : 'No' }}</td>
                                {% else %}
                                    <td>{{ value }}</td>
                                {% endif %}
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="text-neutral">No specifications are available yet.</p>
            {% endif %}
        </div>

        <div class="card w-full bg-base-100 border border-base-300 p-6">
            <h2 class="text-xl font-bold text-primary mb-4">Available Variants</h2>
            {% if item.itemVariants is not empty %}
                <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
                    {% for variant in item.itemVariants %}
                        <div class="card bg-base-200/70 border border-base-300 hover:shadow-md transition">
                            <div class="card-body">
                                <h3 class="card-title text-lg text-primary">{{ variant.name }}</h3>
                                <p class="text-sm text-neutral">Weight : {{ variant.weight }} g</p>
                                <p class="text-sm text-neutral">Price : {{ variant.price|number_format(2, '.', ' ') }} €</p>

                                {% if variant.specifications is not empty %}
                                    <div class="mt-3">
                                        <h4 class="font-semibold text-neutral mb-2">Specifications</h4>
                                        <ul class="list-disc list-inside text-sm text-neutral">
                                            {% for key, value in variant.specifications %}
                                                <li>
                                                    <span class="font-medium capitalize">{{ key|replace({'_':' '}) }}</span> :
                                                    {% if value is iterable %}
                                                        {{ value|map(v => "#{v}")|join(', ') }}
                                                    {% else %}
                                                        {{ value }}
                                                    {% endif %}
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-neutral">No variant available yet.</p>
            {% endif %}
        </div>
    </div>
{% endblock %}
